<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="700" viewBox="0 0 1200 700" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="title desc">
  <title id="title">PubSub MFE Architecture Overview</title>
  <desc id="desc">Diagram showing microfrontend application components connecting to the PubSub Bus and its adapters: Cross-Tab, History, Iframe, and transports.</desc>

  <defs>
    <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
      <stop offset="0%" stop-color="#f6fbff"/>
      <stop offset="100%" stop-color="#eaf6ff"/>
    </linearGradient>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="6" refY="5" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,5 L0,10 z" fill="#333" />
    </marker>
    <style>
      .title { font: 700 20px/1.2 'Segoe UI', Roboto, Arial; fill:#073b4c }
      .box { fill: url(#g1); stroke:#2b7a78; stroke-width:2; rx:10; ry:10 }
      .smallbox { fill:#fff; stroke:#7aa39a; stroke-width:1.6; rx:8; ry:8 }
      .label { font: 600 14px/1 'Segoe UI', Roboto, Arial; fill:#073b4c }
      .muted { font: 400 12px/1 'Segoe UI', Roboto, Arial; fill:#345; opacity:0.8 }
      .adapter { fill:#fff7e6; stroke:#d99f2b; stroke-width:1.6; rx:8; ry:8 }
      .transport { fill:#f7f7f9; stroke:#a7a7b0; stroke-width:1.4; rx:8; ry:8 }
      .shadow { filter: url(#shadow) }
    </style>
    <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#000" flood-opacity="0.12" />
    </filter>
  </defs>

  <!-- Top container label -->
  <rect x="40" y="20" width="1120" height="60" class="box" />
  <text x="80" y="55" class="title">Microfrontend Application</text>

  <!-- Microfrontends row -->
  <g id="mfes">
    <g transform="translate(80,110)">
      <rect x="0" y="0" width="200" height="80" class="smallbox shadow" />
      <text x="100" y="48" text-anchor="middle" class="label">Cart MFE</text>
    </g>

    <g transform="translate(310,110)">
      <rect x="0" y="0" width="200" height="80" class="smallbox shadow" />
      <text x="100" y="48" text-anchor="middle" class="label">Header MFE</text>
    </g>

    <g transform="translate(540,110)">
      <rect x="0" y="0" width="200" height="80" class="smallbox shadow" />
      <text x="100" y="48" text-anchor="middle" class="label">Product MFE</text>
    </g>

    <g transform="translate(770,110)">
      <rect x="0" y="0" width="200" height="80" class="smallbox shadow" />
      <text x="100" y="48" text-anchor="middle" class="label">Auth MFE</text>
    </g>
  </g>

  <!-- PubSub Bus -->
  <g id="bus">
    <rect x="300" y="230" width="600" height="92" class="box shadow" />
    <text x="600" y="285" text-anchor="middle" class="title">PubSub Bus</text>
    <text x="600" y="305" text-anchor="middle" class="muted">Core Engine (topic routing, validation, dispatch)</text>
  </g>

  <!-- connectors from MFEs to Bus -->
  <g stroke="#2b7a78" stroke-width="2" fill="none" marker-end="url(#arrow)">
    <path d="M180 190 L380 260" />
    <path d="M410 190 L480 250" />
    <path d="M650 190 L640 250" />
    <path d="M890 190 L820 260" />
  </g>

  <!-- Adapters row -->
  <g id="adapters">
    <g transform="translate(140,360)">
      <rect x="0" y="0" width="260" height="70" class="adapter shadow" />
      <text x="130" y="42" text-anchor="middle" class="label">Cross-Tab Adapter</text>
    </g>

    <g transform="translate(470,360)">
      <rect x="0" y="0" width="220" height="70" class="adapter shadow" />
      <text x="110" y="42" text-anchor="middle" class="label">History Adapter</text>
    </g>

    <g transform="translate(760,360)">
      <rect x="0" y="0" width="240" height="70" class="adapter shadow" />
      <text x="120" y="42" text-anchor="middle" class="label">Iframe Adapter</text>
    </g>
  </g>

  <!-- lines from Bus down to adapters -->
  <g stroke="#2b7a78" stroke-width="2" fill="none" marker-end="url(#arrow)">
    <path d="M600 322 L270 360" />
    <path d="M600 322 L570 360" />
    <path d="M600 322 L890 360" />
  </g>

  <!-- Transports row -->
  <g id="transports">
    <g transform="translate(140,460)">
      <rect x="0" y="0" width="260" height="56" class="transport shadow" />
      <text x="130" y="35" text-anchor="middle" class="muted">BroadcastChannel</text>
    </g>

    <g transform="translate(470,460)">
      <rect x="0" y="0" width="220" height="56" class="transport shadow" />
      <text x="110" y="35" text-anchor="middle" class="muted">IndexedDB Ledger</text>
    </g>

    <g transform="translate(760,460)">
      <rect x="0" y="0" width="240" height="56" class="transport shadow" />
      <text x="120" y="25" text-anchor="middle" class="muted">MessagePort + postMessage</text>
      <text x="120" y="42" text-anchor="middle" class="muted">(iframe bridge)</text>
    </g>
  </g>

  <!-- connectors from adapters to transports -->
  <g stroke="#7aa39a" stroke-width="1.8" fill="none" marker-end="url(#arrow)">
    <path d="M270 430 L270 460" />
    <path d="M580 430 L580 460" />
    <path d="M900 430 L900 460" />
  </g>

  <!-- Bottom group: Other Tabs / Windows / Iframes -->
  <g>
    <rect x="120" y="540" width="960" height="110" class="box shadow" />
    <text x="600" y="595" text-anchor="middle" class="label">Other Tabs / Windows / Iframes</text>
    <text x="600" y="620" text-anchor="middle" class="muted">(recipients of cross-tab and iframe messages)</text>
  </g>

  <!-- subtle border -->
  <rect x="6" y="6" width="1188" height="660" fill="none" stroke="#e4f0f3" stroke-width="2" rx="12" ry="12" />

</svg>
