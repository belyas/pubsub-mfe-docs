<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Topic Pattern Playground</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Inter,Arial,Helvetica,sans-serif;padding:20px;color:#0f172a}
    .card{background:#fff;border:1px solid #e6eef8;padding:16px;border-radius:8px;max-width:900px;margin:0 auto}
    input,textarea{width:100%;padding:8px;margin:6px 0;border:1px solid #cbd5e1;border-radius:6px}
    .result{font-weight:700;margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h2>Topic Pattern Playground</h2>
    <label>Pattern (supports + and #)</label>
    <input id="pattern" value="cart.+.add" />
    <label>Topic</label>
    <input id="topic" value="cart.item.add" />
    <button id="check">Test Match</button>
    <div class="result" id="result"></div>

    <hr />
    <h3>Matcher debug</h3>
    <pre id="debug" style="white-space:pre-wrap;color:#475569"></pre>
  </div>

  <script type="module">
    import { compileMatcher, matchTopic } from './matcher.js';

    const patternEl = document.getElementById('pattern');
    const topicEl = document.getElementById('topic');
    const resEl = document.getElementById('result');
    const dbg = document.getElementById('debug');
    const btn = document.getElementById('check');

    function run() {
      const p = patternEl.value.trim();
      const t = topicEl.value.trim();

      try {
        const m = compileMatcher(p);
        const ok = matchTopic(t, m);
        resEl.textContent = ok ? 'MATCH ✅' : 'NO MATCH ✖️';
        dbg.textContent = `pattern tokens: ${JSON.stringify(m.segments)}\ntopic tokens: ${JSON.stringify(t.split('.'))}`;
      } catch (err) {
        resEl.textContent = 'ERROR';
        dbg.textContent = err.message;
      }
    }

    btn.addEventListener('click', run);
    run();
  </script>
</body>
</html>