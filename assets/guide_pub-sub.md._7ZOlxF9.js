import{_ as i,o as a,c as e,ag as n}from"./chunks/framework.CbQjVMS6.js";const k=JSON.parse('{"title":"Publishing & Subscribing","description":"","frontmatter":{},"headers":[],"relativePath":"guide/pub-sub.md","filePath":"guide/pub-sub.md"}'),t={name:"guide/pub-sub.md"};function l(p,s,h,r,o,d){return a(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="publishing-subscribing" tabindex="-1">Publishing &amp; Subscribing <a class="header-anchor" href="#publishing-subscribing" aria-label="Permalink to &quot;Publishing &amp; Subscribing&quot;">​</a></h1><p>This page covers the basic publish/subscribe primitives in PubSub MFE: how to publish messages, subscribe to topics, and manage subscription lifetimes.</p><h2 id="publish" tabindex="-1">Publish <a class="header-anchor" href="#publish" aria-label="Permalink to &quot;Publish&quot;">​</a></h2><p>Use <code>bus.publish(topic, payload, options?)</code> to send a message through the bus. The bus will wrap the payload into a standard message envelope which includes metadata (<code>id</code>, <code>ts</code>, <code>topic</code>, <code>payload</code>, <code>meta</code>, ...).</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// TypeScript</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bus.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">publish</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cart.item.add&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { sku: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ABC123&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, qty: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Add optional meta</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bus.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">publish</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;user.login&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { userId: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;u-1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }, { meta: { source: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;auth&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } })</span></span></code></pre></div><p>Notes:</p><ul><li>Publishing is synchronous from the caller&#39;s perspective (message is enqueued and dispatched to local subscribers). Delivery to remote transports (cross-tab) may be asynchronous depending on configured transports.</li><li>You can provide <code>meta</code> and <code>schemaVersion</code> in options to help with tracing and validation.</li></ul><h2 id="subscribe" tabindex="-1">Subscribe <a class="header-anchor" href="#subscribe" aria-label="Permalink to &quot;Subscribe&quot;">​</a></h2><p>Subscribe with <code>bus.subscribe(topicPattern, handler, opts?)</code>. Subscriptions return an <code>unsubscribe</code> function.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> unsubscribe</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bus.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;cart.item.+&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Item event:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, msg.topic, msg.payload)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Remove when no longer needed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unsubscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div><p>Options:</p><ul><li><code>signal?: AbortSignal</code> — remove the subscription when the signal is aborted.</li><li><code>replay?: number</code> — replay last N messages on subscribe.</li><li><code>sourceFilter?: object</code> — Source filter — only receive messages from specific sources.</li></ul><h2 id="one-time-scoped-subscriptions" tabindex="-1">One-time &amp; Scoped Subscriptions <a class="header-anchor" href="#one-time-scoped-subscriptions" aria-label="Permalink to &quot;One-time &amp; Scoped Subscriptions&quot;">​</a></h2><p>For short-lived listeners you can either call the returned <code>unsubscribe()</code> or use an <code>AbortSignal</code>:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> controller</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbortController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bus.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;orders.#&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, handler, { signal: controller.signal })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// later</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">abort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// removes all subscriptions created with this signal</span></span></code></pre></div><h2 id="delivery-guarantees" tabindex="-1">Delivery Guarantees <a class="header-anchor" href="#delivery-guarantees" aria-label="Permalink to &quot;Delivery Guarantees&quot;">​</a></h2><p>PubSub MFE is designed to be lightweight and predictable:</p><ul><li>Local subscribers are invoked asynchronously in publish order (subject to handler isolation).</li><li>Cross-tab or transport-delivered subscribers may receive messages asynchronously.</li><li>There are no built-in guaranteed retries; if you need retries, implement them in your handler or using an intermediate adapter.</li></ul><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">​</a></h2><ul><li>Keep payloads small and focused (IDs + minimal data). Use a shared storage (IndexedDB) for large blobs.</li><li>Use domain-oriented topic naming: <code>domain.entity.action</code> (e.g., <code>cart.item.add</code>).</li><li>Use <code>AbortSignal</code> for lifecycle-managed subscriptions in frameworks.</li></ul><p>See also: <a href="/guide/topic-patterns.html">Topic Patterns</a> and <a href="/guide/handler-isolation.html">Handler Isolation</a>.</p>`,21)])])}const u=i(t,[["render",l]]);export{k as __pageData,u as default};
